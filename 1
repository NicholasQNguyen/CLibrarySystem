#include <stdio.h>
#include <string.h>
#include <ctype.h>
#include <unistd.h>
#include "lib.c"

char* findBook(FILE *library, char* title[])
{
    char temp[1028];
    printf("TITLE: %s \n", title);
    while(fgets(temp, 1028, library) != NULL)
    {
        printf("TEMP: %s \n", temp);
        for (int i = 0; i < strlen(temp); i++)
        {
            temp[i] = tolower(temp[i]);
        }
        if((strstr(temp, title)) != NULL)
        {
            return *temp;
        }
    }
    return NULL;
}

int main(int argc, char* argv[])
{
    if (!checkForCommandLineArgs(argc))
    {
        printf("Command line arguments expected. \n");
        printf("format: \"./findBook <TITLE OF BOOK>\". \n");
        return 1;
    }
    FILE *ptr;
    if (access("books.txt", F_OK) != 0)
    {
        printf("No library found \n");
        printf("Add a book using addBook.\n");
        return 1;
    }
    else
    {
        ptr = fopen("books.txt", "r");
    }
    // Convert the input into lowercase for searching
    for (int i = 1; i < argc; i ++)
    {
        for (int j = 0; j < strlen(argv[i]); j++)
        {
            argv[i][j] = tolower(argv[i][j]);
        }
    }
    printf("ARGV %s \n", *argv);
    char* book = findBook(ptr, argv);
    printf("%s", book);
    if (book)
    {
        printf("%s is available! \n", book); 
    }
    else
    {
        printf("Not found. \n");
    }
    if (ptr)
    {
        fclose(ptr);
    }
    return 0;
}
